#!/usr/bin/env cbqn

# Written after finishing the final tutorial, and skimming the "Quick Start".
# Understanding arrays might have have been really useful, but I guess I'm out
# of luck as they seems to have really increased the difficulty this year to
# combat LLMs.

e1 â† âŸ¨
  "467..114.."
  "...*......"
  "..35..633."
  "......#..."
  "617*......"
  ".....+.58."
  "..592....."
  "......755."
  "...$.*...."
  ".664.598.."
âŸ©

# Ah fuck. this idea is _wrong_
# Game plan:
#   Part 1: 
#     Somehow "467..114.." -> âŸ¨467, 467, 467, 0, 0, 114, 114, 114, 0, 0âŸ©
#   Part 2: 
#     Identify non digit and non . as 1, others as 0
#   Part 3:
#     Propagate all 1s in the part 2 grid in a moore neighbourhood
#   Part 4:
#     Multiply part 3 on part 1 and sum

# Part 1
# Symbols used (from âˆ§â·âˆ¾ on input): #$%&*+-/=@ . 0123456789
symbols â† "#$%&*+-/=@"
# Not very idomatic ;(
IsDigit â† {('0' â‰¤ ğ•©) âˆ§ (ğ•© â‰¤ '9')}
# From BQNCrate: Split ğ•© at occurrences of separators ğ•¨, removing the separators
SplitSep â† {ğ•¨ ((âŠ¢-ËœÂ¬Ã—Â·+`Â»âŠ¸<)âˆ˜âˆŠËœâŠ”âŠ¢) ğ•©}
LineNumbers â† â€¢parseFloatÂ¨ ({0â‰ â‰ Â¨ğ•©}âŠ¸/('.'âˆ¾symbols)âŠ¸SplitSep)
NumberIndex1 â† {
  mask â† IsDigit ğ•©
  # sum reduce over the falling edge
  # add 1 to distinguish between 0s
  mask Ã— 1+ +` (Â»mask) âˆ§ Â¬mask
}
Part1 â† {âŠ‘âŸœ(0âˆ¾(LineNumbers ğ•©))Â¨ (NumberIndex1 ğ•©)}

# Part 2

GetSymbols â† >{âˆ¨Â´ğ•©â·symbols}Â¨Â¨

# Part 3
# Butchered from GoL found on BQNcrate
Propagate â† {âŠ‘1=+Ëâ¥ŠâŒ½âŸœğ•©Â¨â‹ˆâŒœËœÂ¯1â€¿0â€¿1} 

(>Part1Â¨ e1) Ã— (Propagateâˆ˜GetSymbols e1)







# Thoughts:

# The quick start really shows off a lot more BQN that I ever thought existed!
# There's syntax to do pseudo-procedural programming! I wonder how much overlap
# there is with other array languages.

# I couldn't get beacon installed, so I'm giving up on that for now. Someone in
# the discord mentioned that you should install cbqn-replxx via nix to get the
# \ shortcuts. cbqn also has system commands such as )e in addition to
# additional system functions.
# (https://github.com/dzaima/CBQN/blob/master/docs/README.md)

# My current terminal font causes âŒ¾ to overlap with the next character, and I
# need a replacement to BQNPAD's list of characters but once those are sorted
# I can try moving to local development.

input â† â€¢FLines "inputs/day3.txt"
â€¢Show âŸ¨"Symbols: ", âˆ§â·âˆ¾ inputâŸ©
# â€¢Show âŸ¨"Part 1", inputâŸ© 
# â€¢Show âŸ¨"Part 2", inputâŸ© 