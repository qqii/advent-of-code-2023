#!/usr/bin/env cbqn

# Written after day 4, because of a logical error with the first attempt. 

e1 â† âŸ¨
  "467..114.."
  "...*......"
  "..35..633."
  "......#..."
  "617*......"
  ".....+.58."
  "..592....."
  "......755."
  "...$.*...."
  ".664.598.."
âŸ©

# From BQNcreate: Pad with a layer of fill elements on all sides
Pad â† (âŠ¢â†‘ËÂ·â‰âŸœÂ¬2+â‰¢)

GetSymbols â† {Â¬".0123456789"âˆŠËœğ•©}âŠ¸/â·âˆ˜âˆ¾
symbols â† Pad (GetSymbols e1) âˆŠËœ >e1
IsDigit â† {('0' â‰¤ ğ•©) âˆ§ (ğ•© â‰¤ '9')}
digits â† Pad (IsDigitÃ—-âŸœ'0') >e1 

# We need to pad these because Grow wraps the grid
parsed â† symbols â‹ˆÂ¨ digits

# Adapted from BQNcrate GoL to just sum the neighbours to 1 step propogate symbols
Grow â† {0<âŠ‘+Ëâ¥ŠâŒ½âŸœğ•©Â¨â‹ˆâŒœËœÂ¯1â€¿0â€¿1}
# Cull symbols where digits is 0, padding is always culled
Cull â† {
  sâ€¿d â† ğ•©
  (0â‰ sÃ—d)â€¿d
} 
# Spread symbols left and right
Spead â† {
  s â† âŠ‘Â¨ ğ•©
  neighbourhood â† âŒ½âŸœsÂ¨â‹ˆâŒœËœÂ¯1â€¿0â€¿1
  spread â† âŠ‘0<+ËË˜ 1â†‘1â†“ neighbourhood
  spread â‹ˆ Â¨ 1âŠ‘Â¨ ğ•©
}
Harvest â† {
  sâ€¿d â† ğ•©
  d Ã—âŸœs â†©
  (d > 0)âŠ‘'.'â€¿('0'+d)
} 

# Adapted BQNCrate split for digits only
SplitDigits â† {((âŠ¢-ËœÂ¬Ã—Â·+`Â»âŠ¸<)âˆ˜Â¬âˆ˜IsDigitËœâŠ”âŠ¢) ğ•©}
MaxDigitLen â† {âŒˆÂ´ â‰ Â¨ âˆ¾ SplitDigitsÂ¨ ğ•©}

init â† CullÂ¨ Grow âŒ¾ (âŠ‘Â¨) parsed
# If we grew into a digit, we need to spread until we reach the entire number
h â† HarvestÂ¨ CullÂ¨âˆ˜SpeadâŸ(1-ËœMaxDigitLen e1) init

# WIP, now to unravel and parse as floats





# Thoughts:

# The Quick Start really shows off a lot more BQN that I ever thought existed!
# There's syntax to do pseudo-procedural programming! I wonder how much overlap
# there is with other array languages.

# I couldn't get beacon installed, so I'm giving up on that for now. Someone in
# the discord mentioned that you should install cbqn-replxx via nix to get the
# \ shortcuts. cbqn also has system commands such as )e in addition to
# additional system functions.
# (https://github.com/dzaima/CBQN/blob/master/docs/README.md)

# My current terminal font causes âŒ¾ to overlap with the next character, and I
# need a replacement to BQNPAD's list of characters but once those are sorted
# I can try moving to local development.

input â† â€¢FLines "inputs/day3.txt"
# â€¢Show âŸ¨"Part 1", inputâŸ© 
# â€¢Show âŸ¨"Part 2", inputâŸ© 