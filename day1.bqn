#!/usr/bin/env cbqn

# First time using an array programming language.

# Written and executed in BQNPAD after finishing the "Expressions" and 
# "List manipulation" tutorials, with the help of a lot of searching.
# https://mlochbaum.github.io/BQN/tutorial/index.html

# Manually created by applying regex transformations in vscode.
# $ -> "
# ^ ->   "
e1 â† âŸ¨
  "1abc2"
  "pqr3stu8vwx"
  "a1b2c3d4e5f"
  "treb7uchet"
âŸ©
e2 â† âŸ¨
  "two1nine"
  "eightwothree" 
  "abcone2threexyz"
  "xtwone3four"
  "4nineeightseven2"
  "zoneight234"
  "7pqrstsixteen"
âŸ©

digits â† '0'+â†•10
digit_words â† "one"â€¿"two"â€¿"three"â€¿"four"â€¿"five"â€¿"six"â€¿"seven"â€¿"eight"â€¿"nine"

# found on https://mlochbaum.github.io/bqncrate/
IsDigit â† {('0' â‰¤ ğ•©) âˆ§ (ğ•© â‰¤ '9')}
# / drop, numpy's arr[arr_of_bools]
GetDigits â† {(IsDigit ğ•©) / ğ•©}
FirstDigit â† {(âŠâˆ˜GetDigitsÂ¨ ğ•©)}
FirstLast â† {ğ•© âˆ¾Â¨â—‹FirstDigit âŒ½Â¨ ğ•©}
â€¢Show âŸ¨"Example Part 1", +Â´ â€¢ParseFloatÂ¨ FirstLast e1âŸ©

# Taken from https://github.com/mlochbaum/bqn-libs/blob/master/strings.bqn
# Usage: âŸ¨"cat"â€¿"red", "dog"â€¿"blue"âŸ© ReplaceAll "My red cat"
# Replace each instance of a string in old with the corresponding
# string in new.
# Instances are non-overlapping, and earlier ones take precedence.
ReplaceAll â† { âŸ¨old,newâŸ© ğ•Š str:
  ! (â‰ new) â‰¡ l â† â‰ old
  "ReplaceAll: Can't replace empty" ! âˆ§Â´0<â‰ Â¨old
  match â† 1-Ëœ (l+1)|âŒŠÂ´ (â†•âŠ¸-l) Ã— old (1<â‰ âˆ˜âŠ£)â—¶âŸ¨âŠ‘âŠ¸=,â‰ âˆ˜âŠ¢â†‘â·âŸ©Â¨ <str
  cont â† (-âŸœ1âŒˆâ‰¤âŸœ1Ã—âŠ¢)` match âŠ (â‰ Â¨old)âˆ¾0
  keep â† â‹ˆâŸœ(âŠâŸœstr) / 0=cont
  insert â† (newâŠËœâŠâŸœmatch)âŠ¸(â‰ Â¨âŠ¸/â‹ˆâˆ¾âˆ˜âŠ£) / (0âŠ¸<âˆ§Â»âŠ¸â‰¤) cont
  â‹âŠ¸âŠÂ´ keep âˆ¾Â¨ insert
}

FirstLastIncWords â† {
  digits1 â† â‹ˆÂ¨1â†“digits
  # ReplaceAll only works for non overlapping, but
  # "3one8ncctmbsixeight_twone_gb" -> 31
  f_replace â† âŸ¨digit_words, digits1âŸ©âŠ¸ ReplaceAllÂ¨ ğ•©
  b_replace â† âŸ¨âŒ½Â¨digit_words, digits1âŸ©âŠ¸ ReplaceAllÂ¨ âŒ½Â¨ğ•©
  (FirstDigit f_replace) âˆ¾Â¨ FirstDigit b_replace
}
â€¢Show âŸ¨"Example Part 2", +Â´ â€¢ParseFloatÂ¨ FirstLastIncWords e2âŸ©

# Final thoughts:

# I'm sure the approach I took was pretty naive, and far from idomatic. I'm 
# suprised by how quickly I'm remebering the symbols and keyboard shortcuts. It
# was suprising how instinctivly I reached for âŠ¸, even though I wouldn't be
# able to explain the presidence rules. âŸœ still eludes me, but I'm sure I'll
# get there. 

# The mixture of symbol memory combined with BQNPAD's word completion made made
# pretty easy to express myself, but BQN's decision give symbols different words
# tripped me up a few times. Â¯ = minus, â†• = range/windows (rather than iota).

# BQNPAD also made my life a huge pain. Multiple times I accidentally closed the
# window, and couldn't reopen it. Since it stores the text as part of the URL,
# when I added the real input this made the URL too long and it wouldn't load.
# I need to get a dev environment set up so I can run BQN locally.

# The BQN resources also seem a lot sparser than APL. BQN is supposed to be the
# new hotness, but I'm not sure how much of that is hype. The comparison with
# other array languages (https://mlochbaum.github.io/BQN/doc/based.html) goes
# pretty over my head, so it's to be seen how much benifit I'll get from 
# starting with BQN.

input â† â€¢FLines "inputs/day1.txt"
â€¢Show âŸ¨"Part 1", +Â´ â€¢ParseFloatÂ¨ FirstLast inputâŸ©
â€¢Show âŸ¨"Part 2", +Â´ â€¢ParseFloatÂ¨ FirstLastIncWords inputâŸ©