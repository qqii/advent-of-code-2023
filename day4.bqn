#!/usr/bin/env cbqn

# Day 3 and how to use arrays in BQN is kicking my ass, but day 4 deceptivly
# simple, so I'm skipping ahead. Not even going to read and more docs, so I'm
# still at finishing "Quick Start". 

e1 â† âŸ¨
  "Card 1: 41 48 83 86 17 | 83 86  6 31 17  9 48 53"
  "Card 2: 13 32 20 16 61 | 61 30 68 82 17 32 24 19"
  "Card 3:  1 21 53 59 44 | 69 82 63 72 16 21 14  1"
  "Card 4: 41 92 73 84 69 | 59 84 76 51 58  5 54 83"
  "Card 5: 87 83 26 28 32 | 88 30 70 12 93 22 82 36"
  "Card 6: 31 18 13 56 72 | 74 77 10 23 35 67 36 11"
âŸ©

# From BQNCrate: Split ğ•© at occurrences of separators ğ•¨, removing the separators
SplitSep â† {ğ•¨ ((âŠ¢-ËœÂ¬Ã—Â·+`Â»âŠ¸<)âˆ˜âˆŠËœâŠ”âŠ¢) ğ•©}
# dzaima again comes to explain:
# (âŠ¢-ËœÂ¬Ã—Â·+`Â»âŠ¸<)
#    â‰¡
# {ğ•© -Ëœ (Â¬ğ•©) Ã— +` (Â»ğ•©) < ğ•©}
# buy I need to work through why " " SplitSep "  x" â‰¡ ""â€¿"x"
SplitSep0 â† {
  ss â† ğ•¨ SplitSep ğ•©
  {0â‰ â‰ Â¨ ss}/ss
}

Parse â† {
  wc â† 1â†“":|"âŠ¸SplitSep0 ğ•©
  Parse â† â€¢parseFloatÂ¨ " "âŠ¸SplitSep0
  winners â† Parse âŠ‘wc
  card â† Parse 1âŠ‘ wc
  winnersâ€¿card
}
Points â† {âŒŠ2â‹†1-Ëœ+Â´(1âŠ‘ğ•©) âˆŠ âŠ‘ğ•©}
Part1 â† +Â´ Pointsâˆ˜ParseÂ¨
â€¢Show âŸ¨"Example Part 1", Part1 e1âŸ© 

Matches â† {+Â´(1âŠ‘ğ•©) âˆŠ âŠ‘ğ•©}
Zeros â† 0â¥ŠËœâŠ¢
Part2 â† +Â´{
  p2 â† Matchesâˆ˜ParseÂ¨ ğ•©
  Win â† {
    # very not in the spirit, capturing p2 and all that
    (Zeros ğ•¨) âˆ¾ (1 + Zeros ğ•©) âˆ¾ (Zeros (ğ•¨ -Ëœ ğ•© -Ëœ â‰ p2))
  }
  
  card â† â†•â‰ p2
  # Build this in perp for a fold, but I need the card index...
  tagged â† âŸ¨1+Zerosâ‰ p2âŸ© âˆ¾ (card â‹ˆÂ¨ {(1+â†•â‰ ğ•©) WinÂ¨ ğ•©} p2)

  Go â† {
    cards â† ğ•¨
    iâ€¿won â† ğ•©
  
    cards + won Ã— iâŠ‘cards
  }
  # left fold via ËœÂ´âŒ½
  GoËœÂ´âŒ½ tagged
}
â€¢Show âŸ¨"Example Part 2", Part2 e1âŸ©

# Thoughts:

# Part 1 wasn't too bad, but I need to study SplitSep more. Luckily grhkm
# asked about it and dzaima has come to the rescue to break it down. 

# Part 2 I really forced a fold. There must be a more idiomaic way using â†© and
# âŸ, or even a way to do it without capturing the number of cards in Win...?

input â† â€¢FLines "inputs/day4.txt"
â€¢Show âŸ¨"Part 1", Part1 inputâŸ© 
â€¢Show âŸ¨"Part 2", Part2 inputâŸ© 