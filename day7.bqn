#!/usr/bin/env cbqn

# Part 1 Initial Idea:
# Build a table with headings:
# [ "Hand", "Bid", "Hand Score", "Card Score"]
# "Card Score" should be equivilent to comparing for the highest consecutive
# hand. Then sort with â‹ âˆ¨ â’.

e1 â† âŸ¨
  "32T3K 765"
  "T55J5 684"
  "KK677 28"
  "KTJJT 220"
  "QQQJA 483"
âŸ©

Split â† {((Â¯1+âŠ¢Ã—Â·+`Â»âŠ¸<)Â¬ğ•©=ğ•¨)âŠ”ğ•©}
Parse â† â€¢ParseFloatâŒ¾(1âŠ¸âŠ‘)âˆ˜(' 'âŠ¸Split)Â¨

hands â† âŒ½âŸ¨
  âŸ¨5âŸ©
  âŸ¨4, 1âŸ©
  âŸ¨3, 2âŸ©
  âŸ¨3, 1, 1âŸ©
  âŸ¨2, 2, 1âŸ©
  âŸ¨2, 1, 1, 1âŸ©
  âŸ¨1, 1, 1, 1, 1âŸ©
âŸ©
cards â† "23456789TJQKA"

# From BQNcrate: Count of occurrences of each unique major cell
CountOccurances â† /â¼âŠ
ScoreHand â† âŠ‘handsâŠ’â‹ˆ âˆ˜ âˆ¨âˆ˜CountOccurances
# 13 Cards -> Base 13
ScoreCards â† (13âŠ¸Ã—âŠ¸+ËœÂ´âˆ˜âŒ½) cardsâŠ¸âŠ
# Hands of 5 -> (ScoreHand ğ•©) Ã— 13Ã—5 
Score â† (ScoreHand((13â‹†5)âŠ¸Ã—âŠ¸+)ScoreCards)

# From BQNcrate: Sort ğ•© descending according to column ğ•¨
SortBy â† (âŠâ‰1â’âŠ¸âŠâŠ¢)
#p â† Parse input
#s â† â‹ Scoreâˆ˜âŠ‘Â¨ p
#b â† 1âŠ‘Â¨ p
Part1 â† {
  t â† >ScoreâŒ¾âŠ‘Â¨ Parse ğ•©
  st â† (âŠË˜t)â‹âŠ¸âŠt # From # https://mlochbaum.github.io/BQN/doc/order.html#stability
  b â† â¥Š1â†“â‰ st
  m â† 1+â†•â‰  b
  +Â´ bÃ—m
}
â€¢Show âŸ¨"Example Part 1", Part1 e1âŸ© 

# Part 2 Initial Idea:
# Calculate the hand without jokers, then add 1 to the highest group before
# scoring.

cardsJ â† "J23456789TQKA"
ScoreHandJ â† {
  "JJJJJ"â‰¡ğ•© ? 6 ;
  js â† +Â´'J'= ğ•©
  not_js â† 'J'âŠ¸â‰ âŠ¸/ ğ•©
  j_h â† js+âŒ¾âŠ‘ âˆ¨âˆ˜CountOccurances not_js
  âŠ‘handsâŠ’â‹ˆ j_h
}
ScoreCardsJ â† (13âŠ¸Ã—âŠ¸+ËœÂ´âˆ˜âŒ½) cardsJâŠ¸âŠ
ScoreJ â† (ScoreHandJ((13â‹†5)âŠ¸Ã—âŠ¸+)ScoreCardsJ)
Part2 â† {
  t â† >ScoreJâŒ¾âŠ‘Â¨ Parse ğ•©
  st â† (âŠË˜t)â‹âŠ¸âŠt # From # https://mlochbaum.github.io/BQN/doc/order.html#stability
  b â† â¥Š1â†“â‰ st
  m â† 1+â†•â‰  b
  +Â´ bÃ—m
}
â€¢Show âŸ¨"Example Part 2", Part2 e1âŸ© 

# Initial Thoughts:

# Trying out https://bqn.funmaker.moe/ today to replace BQNPAD. There's a bunch
# of nify features but the big one is their glyph hilighting.

# Skipping 5 to finish 3 yesterday, I've not had much time to keep reading but
# I've come across â‹ and â’ when searching BQNcrate. The stability example looks
# like a perfect way to solve today's problem.
# https://mlochbaum.github.io/BQN/doc/order.html#stability

# Post Part 1 Thoughts:

# When defining the card score I had the idea to map the cards into base 13,
# which works out pretty well. This made me realise that the hand score can also
# be included, so the order is completely predetermined in parallel.

# Piecing together the solution in Part1 could have been better, that's pretty
# brute forced. I went for âŒ¾ because I couldn't figure out how to vstack so
# that required me to practice defining Score as a train.

# All in all, I need to take a deeper look at â‹ and â’.

input â† â€¢FLines "inputs/day7.txt"
â€¢Show âŸ¨"Part 1", Part1 inputâŸ© 
â€¢Show âŸ¨"Part 2", Part2 inputâŸ© 